'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _getOwnPropertyNames = require('babel-runtime/core-js/object/get-own-property-names');

var _getOwnPropertyNames2 = _interopRequireDefault(_getOwnPropertyNames);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _createFunctionProxy(wrapperObject, functionName, targetObject, handlers) {
  wrapperObject[functionName] = function () {
    var _targetObject$functio;

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    handlers.onCall && handlers.onCall(functionName, args);
    var result = (_targetObject$functio = targetObject[functionName]).call.apply(_targetObject$functio, [targetObject].concat(args));

    var modifiedResult = false;
    if (handlers.afterCall) {
      modifiedResult = handlers.afterCall(functionName, args, result);
    }

    return modifiedResult || result;
  };
}

function _createGetterProxy(wrapperObject, propertyName, targetObject, handlers) {
  var getterName = _accessorName(propertyName, 'get');
  wrapperObject[getterName] = function () {
    handlers.onGet && handlers.onGet(propertyName);
    var result = targetObject[propertyName];
    handlers.afterGet && handlers.afterGet(propertyName, result);

    return result;
  };
}

function _createSetterProxy(wrapperObject, propertyName, targetObject, handlers) {
  var setterName = _accessorName(propertyName, 'set');
  wrapperObject[setterName] = function (v) {
    handlers.onSet && handlers.onSet(propertyName, v);
    targetObject[propertyName] = v;
    handlers.afterSet && handlers.afterSet(propertyName, v, wrapperObject);

    return wrapperObject;
  };
}

function _collectAllPropertyNames(object) {
  var exclude = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  var result = (0, _getOwnPropertyNames2.default)(object).filter(function (p) {
    return exclude.indexOf(p) < 0;
  });

  if (object.__proto__.__proto__) {
    result = result.concat(_collectAllPropertyNames(object.__proto__, exclude));
  }

  return result.filter(function (p) {
    return p !== 'constructor';
  });
}

function _accessorName(property, type) {
  return type + property[0].toUpperCase() + (property.length > 1 ? property.substr(1) : '');
}

function _isFunction(value) {
  return value && {}.toString.call(value) === '[object Function]';
}

var ObjectWrapper = function () {
  function ObjectWrapper() {
    (0, _classCallCheck3.default)(this, ObjectWrapper);
  }

  (0, _createClass3.default)(ObjectWrapper, null, [{
    key: 'addWrapperInterface',
    value: function addWrapperInterface(wrapper, innerObject) {
      var exclude = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
      var createGetters = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
      var createSetters = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;
      var excludeSemiPrivate = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : true;
      var handlers = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : {};

      _collectAllPropertyNames(innerObject, exclude).forEach(function (k) {
        if (excludeSemiPrivate && k[0] === '_') {
          // do nothing
        } else if (_isFunction(innerObject[k])) {
          _createFunctionProxy(wrapper, k, innerObject, handlers);
        } else {
          if (createGetters) {
            _createGetterProxy(wrapper, k, innerObject, handlers);
          }
          if (createSetters) {
            _createSetterProxy(wrapper, k, innerObject, handlers);
          }
        }
      });

      return wrapper;
    }
  }]);
  return ObjectWrapper;
}();

exports.default = ObjectWrapper;